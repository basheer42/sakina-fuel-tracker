"use strict";window.SelectFilter={init:function(e,t,l){if(e.match(/__prefix__/))return;const n=document.getElementById(e);n.id+="_from",n.className="filtered",n.setAttribute("aria-labelledby",e+"_from_title");for(const e of n.parentNode.getElementsByTagName("p"))e.classList.contains("info")?n.parentNode.removeChild(e):e.classList.contains("help")&&n.parentNode.insertBefore(e,n.parentNode.firstChild);const o=quickElement("div",n.parentNode);n.parentNode.prepend(o),o.className=l?"selector stacked":"selector";const i=quickElement("div",o);i.className="selector-available";const c=quickElement("div",i);c.id=e+"_from_title",c.className="selector-available-title",quickElement("label",c,interpolate(gettext("Available %s")+" ",[t]),"for",e+"_from"),quickElement("p",c,interpolate(gettext('Choose %s by selecting them and then select the "Choose" arrow button.'),[t]),"class","helptext");const s=quickElement("p",i,"","id",e+"_filter");s.className="selector-filter";const r=quickElement("label",s,"","for",e+"_input");quickElement("span",r,"","class","help-tooltip search-label-icon","aria-label",interpolate(gettext("Type into this box to filter down the list of available %s."),[t])),s.appendChild(document.createTextNode(" "));const d=quickElement("input",s,"","type","text","placeholder",gettext("Filter"));d.id=e+"_input",i.appendChild(n);const a=quickElement("button",i,interpolate(gettext("Choose all %s"),[t]),"id",e+"_add_all","class","selector-chooseall"),_=quickElement("ul",o);_.className="selector-chooser";const m=quickElement("button",quickElement("li",_),interpolate(gettext("Choose selected %s"),[t]),"id",e+"_add","class","selector-add"),f=quickElement("button",quickElement("li",_),interpolate(gettext("Remove selected %s"),[t]),"id",e+"_remove","class","selector-remove"),u=quickElement("div",o,"","id",e+"_selector_chosen");u.className="selector-chosen";const h=quickElement("div",u);h.className="selector-chosen-title",h.id=e+"_to_title",quickElement("label",h,interpolate(gettext("Chosen %s")+" ",[t]),"for",e+"_to"),quickElement("p",h,interpolate(gettext('Remove %s by selecting them and then select the "Remove" arrow button.'),[t]),"class","helptext");const p=quickElement("p",u,"","id",e+"_filter_selected");p.className="selector-filter";const k=quickElement("label",p,"","for",e+"_selected_input");quickElement("span",k,"","class","help-tooltip search-label-icon","aria-label",interpolate(gettext("Type into this box to filter down the list of selected %s."),[t])),p.appendChild(document.createTextNode(" "));const E=quickElement("input",p,"","type","text","placeholder",gettext("Filter"));E.id=e+"_selected_input",quickElement("select",u,"","id",e+"_to","multiple","","size",n.size,"name",n.name,"aria-labelledby",e+"_to_title","class","filtered");const y=quickElement("div",u,"","class","list-footer-display");quickElement("span",y,"","id",e+"_list-footer-display-text"),quickElement("span",y," "+gettext("(click to clear)"),"class","list-footer-display__clear");const x=quickElement("button",u,interpolate(gettext("Remove all %s"),[t]),"id",e+"_remove_all","class","selector-clearall");n.name=n.name+"_old";const v=function(t,l,n,o,i){l.hasAttribute("disabled")||(n(o,i),SelectFilter.refresh_icons(e),SelectFilter.refresh_filtered_selects(e),SelectFilter.refresh_filtered_warning(e)),t.preventDefault()};a.addEventListener("click",(function(t){v(t,this,SelectBox.move_all,e+"_from",e+"_to")})),m.addEventListener("click",(function(t){v(t,this,SelectBox.move,e+"_from",e+"_to")})),f.addEventListener("click",(function(t){v(t,this,SelectBox.move,e+"_to",e+"_from")})),x.addEventListener("click",(function(t){v(t,this,SelectBox.move_all,e+"_to",e+"_from")})),y.addEventListener("click",(function(t){E.value="",SelectBox.filter(e+"_to",""),SelectFilter.refresh_filtered_warning(e),SelectFilter.refresh_icons(e)})),d.addEventListener("keypress",(function(t){SelectFilter.filter_key_press(t,e,"_from","_to")})),d.addEventListener("keyup",(function(t){SelectFilter.filter_key_up(t,e,"_from")})),d.addEventListener("keydown",(function(t){SelectFilter.filter_key_down(t,e,"_from","_to")})),E.addEventListener("keypress",(function(t){SelectFilter.filter_key_press(t,e,"_to","_from")})),E.addEventListener("keyup",(function(t){SelectFilter.filter_key_up(t,e,"_to","_selected_input")})),E.addEventListener("keydown",(function(t){SelectFilter.filter_key_down(t,e,"_to","_from")})),o.addEventListener("change",(function(t){"SELECT"===t.target.tagName&&SelectFilter.refresh_icons(e)})),o.addEventListener("dblclick",(function(t){"OPTION"===t.target.tagName&&(t.target.closest("select").id===e+"_to"?SelectBox.move(e+"_to",e+"_from"):SelectBox.move(e+"_from",e+"_to"),SelectFilter.refresh_icons(e))})),n.closest("form").addEventListener("submit",(function(){SelectBox.filter(e+"_to",""),SelectBox.select_all(e+"_to")})),SelectBox.init(e+"_from"),SelectBox.init(e+"_to"),SelectBox.move(e+"_from",e+"_to"),SelectFilter.refresh_icons(e)},any_selected:function(e){e.required=!0;const t=e.checkValidity();return e.required=!1,t},refresh_filtered_warning:function(e){const t=SelectBox.get_hidden_node_count(e+"_to"),l=document.getElementById(e+"_selector_chosen"),n=document.getElementById(e+"_list-footer-display-text");l.className=l.className.replace("selector-chosen--with-filtered",""),n.textContent=interpolate(ngettext("%s selected option not visible","%s selected options not visible",t),[t]),t>0&&(l.className+=" selector-chosen--with-filtered")},refresh_filtered_selects:function(e){SelectBox.filter(e+"_from",document.getElementById(e+"_input").value),SelectBox.filter(e+"_to",document.getElementById(e+"_selected_input").value)},refresh_icons:function(e){const t=document.getElementById(e+"_from"),l=document.getElementById(e+"_to");document.getElementById(e+"_add").disabled=!SelectFilter.any_selected(t),document.getElementById(e+"_remove").disabled=!SelectFilter.any_selected(l),document.getElementById(e+"_add_all").disabled=!t.querySelector("option"),document.getElementById(e+"_remove_all").disabled=!l.querySelector("option")},filter_key_press:function(e,t,l,n){const o=document.getElementById(t+l);(e.which&&13===e.which||e.keyCode&&13===e.keyCode)&&(o.selectedIndex=0,SelectBox.move(t+l,t+n),o.selectedIndex=0,e.preventDefault())},filter_key_up:function(e,t,l,n){const o=n||"_input",i=document.getElementById(t+l),c=i.selectedIndex;SelectBox.filter(t+l,document.getElementById(t+o).value),i.selectedIndex=c,SelectFilter.refresh_filtered_warning(t),SelectFilter.refresh_icons(t)},filter_key_down:function(e,t,l,n){const o=document.getElementById(t+l),i="_from"===l?39:37;if(e.which&&e.which===i||e.keyCode&&e.keyCode===i){const e=o.selectedIndex;return SelectBox.move(t+l,t+n),SelectFilter.refresh_filtered_selects(t),SelectFilter.refresh_filtered_warning(t),void(o.selectedIndex=e===o.length?o.length-1:e)}(e.which&&40===e.which||e.keyCode&&40===e.keyCode)&&(o.selectedIndex=o.length===o.selectedIndex+1?0:o.selectedIndex+1),(e.which&&38===e.which||e.keyCode&&38===e.keyCode)&&(o.selectedIndex=0===o.selectedIndex?o.length-1:o.selectedIndex-1)}},window.addEventListener("load",(function(e){document.querySelectorAll("select.selectfilter, select.selectfilterstacked").forEach((function(e){const t=e.dataset;SelectFilter.init(e.id,t.fieldName,parseInt(t.isStacked,10))}))}));